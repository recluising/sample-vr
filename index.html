<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello, WebVR! • A-Frame</title>
    <meta name="description" content="Hello, WebVR! • A-Frame">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('input-listen', {
        init:
            function () {
              let textField;
              setTimeout(()=>{
                textField = document.getElementById('text');
                textField.setAttribute('value', "ready");
              },4000)
              
                const setText =(text)=>{
                  if(!textField){
                    textField = document.getElementById('text');
                  }
                  textField.value = text;
                }
                //Declaration and initialization of flag 
                //which exprains grip button is pressed or not.
                //"this.el" reffers ctlR or L in this function
                this.el.grip = false;

                //Called when trigger is pressed 
                this.el.addEventListener('triggerdown', function (e) {
                    //"this" reffers ctlR or L in this function
                    // var point = this.object3D.getWorldPosition();

                    // //txt.setAttribute("value",point.x.toFixed(2)+","+point.y.toFixed(2)+","+point.z.toFixed(2));

                    // //Creating ball entity.
                    // var ball = document.createElement('a-sphere');
                    // ball.setAttribute('class', 'ball');
                    // ball.setAttribute('scale', '0.2 0.2 0.2');
                    // ball.setAttribute('position', point);
                    // ball.setAttribute('dynamic-body', 'shape: sphere; sphereRadius:0.2; ');

                    // //Getting raycaster which was attached to ctrlR or L
                    // var dir = this.getAttribute("raycaster").direction;

                    // //Setting shoot dierction and speed 
                    // var force = new THREE.Vector3(dir.x, dir.y, dir.z);
                    // force.multiplyScalar(2000);                   
                    // ball.force = this.object3D.localToWorld(force);

                    // //Instantiate ball entity in a-scene
                    // var scene = document.querySelector('a-scene');
                    // scene.appendChild(ball);

                    // //shoot "ball" after physics information getting ready. 
                    // ball.addEventListener('body-loaded', function (e) {
                    //     //"this" reffers ball entity in this function
                    //     var p = this.object3D.position;
                    //     //this.velocity was calculated before this function is called.
                    //     var f = this.force;
                    //     this.body.applyForce(
                    //         new CANNON.Vec3(f.x, f.y, f.z),
                    //         new CANNON.Vec3(p.x, p.y, p.z)
                    //     );
                    // });

                    setText('triggerDown');

                });

                //Grip Pressed
                // this.el.addEventListener('gripdown', function (e) {
                //     //Setting grip flag as true.
                //     this.grip = true;
                // });
                // //Grip Released
                // this.el.addEventListener('gripup', function (e) {
                //     //Setting grip flag as false.
                //     this.grip = false;
                // });

                // //Raycaster intersected with something.
                // this.el.addEventListener('raycaster-intersection', function (e) {
                //     //Store first selected object as selectedObj 
                //     this.selectedObj = e.detail.els[0];
                // });
                // //Raycaster intersection is finished.
                // this.el.addEventListener('raycaster-intersection-cleared', function (e) {
                //     //Clear information of selectedObj
                //     this.selectedObj = null;
                // });

                //A-buttorn Pressed 
                this.el.addEventListener('abuttondown', function (e) {
                    //Aqurire all ball entities which are instantiated in a-scene
                    // var els = document.querySelectorAll('.ball');
                    // //Destroy all ball entities
                    // for (var i = 0; i < els.length; i++) {
                    //     els[i].parentNode.removeChild(els[i]);
                    // }
                    setText('abuttondown')
                });

                //X-buttorn Pressed 
                this.el.addEventListener('xbuttondown', function (e) {
                    //Start pointing position to teleport  
                    // this.emit('teleportstart');
                    setText('xbuttondown')
                });

                //X-buttorn Released 
                this.el.addEventListener('xbuttonup', function (e) {
                    //Jump to pointed position
                    setText('xbuttonup')
                });

                //console.log(this);
            },

        //called evry frame.
        tick: function () {

            // if (!this.el.selectedObj) { return; }
            // if (!this.el.grip) { return; }
          
            // //Getting raycaster component which is attatched to ctlR or L
            // //this.el means entity of ctlR or L in this function.
            // var ray = this.el.getAttribute("raycaster").direction;
            // //setting tip of raycaster as 1.1m forward of controller.  
            // var p = new THREE.Vector3(ray.x, ray.y, ray.z);
            // p.normalize();
            // p.multiplyScalar(1.2);
            // //Convert local position into world coordinate.
            // this.el.object3D.localToWorld(p);
            // //Move selected object to follow the tip of raycaster.
            // this.el.selectedObj.object3D.position.set(p.x, p.y, p.z);
        }
      });

// setInterval(()=>{
//         const sphere = document.querySelector('#sphere');
//       sphere.object3D.position.set(sphere.object3D.position.x + 0.5,sphere.object3D.position.y,sphere.object3D.position.z )
//       },1000)

      
    </script>
  </head>
  <body>
    <div id="info"></div>
    <a-scene>
      <!-- <a-torus position="0 1.25 -5" radius="5" color="red"></a-torus>
      <a-torus position="0 1.25 -5" radius="4" color="orange"></a-torus>
      <a-torus position="0 1.25 -5" radius="3" color="blue"></a-torus>
      <a-torus position="0 1.25 -5" radius="2" color="hotpink"></a-torus> -->
      
    <!--   pillars -->
      <!-- <a-cylinder position="-1 1 -3" rotation="0 0 0" radius="0.1" height="2" color="magenta"></a-cylinder>
      <a-cylinder position="1 1 -3" radius="0.1" height="2" color="magenta"></a-cylinder> -->
      
    <!--   banner -->
      <!-- <a-box color="tomato" position="0 1.7 -3" rotation="0 0 0" depth="0.1" height="0.5" width="2"></a-box> -->
      <a-text id="text" value="Hello A-Frame!" position="-0.9 1.7 -2.9" width="7" height="auto" color="black" oculus-touch-controls="hand: right" input-listen></a-text>
      
    <!--   ground and sky -->
      <!-- <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane> -->
      <a-sky color="lightblue"></a-sky>
    </a-scene>
    
  </body>

  
</html>