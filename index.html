<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello, WebVR! • A-Frame</title>
    <meta name="description" content="Hello, WebVR! • A-Frame">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('input-listen', {
        init:
            function () {
              this.el.addEventListener('triggerdown', function (e) {
                const console = document.qerElementById('consolePlane');
                console.setAttribute('text',`value: ${this.object3D.getWorldPosition()}; color:white;`)
                // this.object3D.getWorldPosition()
              });
            }
      });


      // AFRAME.registerComponent('input-listen', {
      //   init:
      //       function () {
      //         let textField;
      //         setTimeout(()=>{
      //           textField = document.getElementById('text');
      //           textField.setAttribute('value', "ready");
      //         },4000)
              
      //           const setText =(text)=>{
      //             if(!textField){
      //               textField = document.getElementById('text');
      //             }
      //             textField.setAttribute('value', text);
      //           }
      //           //Declaration and initialization of flag 
      //           //which exprains grip button is pressed or not.
      //           //"this.el" reffers ctlR or L in this function
      //           // this.el.grip = false;

      //           //Called when trigger is pressed 
      //           this.el.addEventListener('triggerdown', function (e) {
      //               //"this" reffers ctlR or L in this function
      //               // var point = this.object3D.getWorldPosition();

      //               // //txt.setAttribute("value",point.x.toFixed(2)+","+point.y.toFixed(2)+","+point.z.toFixed(2));

      //               // //Creating ball entity.
      //               // var ball = document.createElement('a-sphere');
      //               // ball.setAttribute('class', 'ball');
      //               // ball.setAttribute('scale', '0.2 0.2 0.2');
      //               // ball.setAttribute('position', point);
      //               // ball.setAttribute('dynamic-body', 'shape: sphere; sphereRadius:0.2; ');

      //               // //Getting raycaster which was attached to ctrlR or L
      //               // var dir = this.getAttribute("raycaster").direction;

      //               // //Setting shoot dierction and speed 
      //               // var force = new THREE.Vector3(dir.x, dir.y, dir.z);
      //               // force.multiplyScalar(2000);                   
      //               // ball.force = this.object3D.localToWorld(force);

      //               // //Instantiate ball entity in a-scene
      //               // var scene = document.querySelector('a-scene');
      //               // scene.appendChild(ball);

      //               // //shoot "ball" after physics information getting ready. 
      //               // ball.addEventListener('body-loaded', function (e) {
      //               //     //"this" reffers ball entity in this function
      //               //     var p = this.object3D.position;
      //               //     //this.velocity was calculated before this function is called.
      //               //     var f = this.force;
      //               //     this.body.applyForce(
      //               //         new CANNON.Vec3(f.x, f.y, f.z),
      //               //         new CANNON.Vec3(p.x, p.y, p.z)
      //               //     );
      //               // });

      //               setText('triggerDown');

      //           });

      //           //Grip Pressed
      //           // this.el.addEventListener('gripdown', function (e) {
      //           //     //Setting grip flag as true.
      //           //     this.grip = true;
      //           // });
      //           // //Grip Released
      //           // this.el.addEventListener('gripup', function (e) {
      //           //     //Setting grip flag as false.
      //           //     this.grip = false;
      //           // });

      //           // //Raycaster intersected with something.
      //           // this.el.addEventListener('raycaster-intersection', function (e) {
      //           //     //Store first selected object as selectedObj 
      //           //     this.selectedObj = e.detail.els[0];
      //           // });
      //           // //Raycaster intersection is finished.
      //           // this.el.addEventListener('raycaster-intersection-cleared', function (e) {
      //           //     //Clear information of selectedObj
      //           //     this.selectedObj = null;
      //           // });

      //           //A-buttorn Pressed 
      //           this.el.addEventListener('abuttondown', function (e) {
      //               //Aqurire all ball entities which are instantiated in a-scene
      //               // var els = document.querySelectorAll('.ball');
      //               // //Destroy all ball entities
      //               // for (var i = 0; i < els.length; i++) {
      //               //     els[i].parentNode.removeChild(els[i]);
      //               // }
      //               setText('abuttondown')
      //           });

      //           //X-buttorn Pressed 
      //           this.el.addEventListener('xbuttondown', function (e) {
      //               //Start pointing position to teleport  
      //               // this.emit('teleportstart');
      //               setText('xbuttondown')
      //           });

      //           //X-buttorn Released 
      //           this.el.addEventListener('xbuttonup', function (e) {
      //               //Jump to pointed position
      //               setText('xbuttonup')
      //           });

      //           //console.log(this);
      //       },

      //   //called evry frame.
      //   tick: function () {

      //       // if (!this.el.selectedObj) { return; }
      //       // if (!this.el.grip) { return; }
          
      //       // //Getting raycaster component which is attatched to ctlR or L
      //       // //this.el means entity of ctlR or L in this function.
      //       // var ray = this.el.getAttribute("raycaster").direction;
      //       // //setting tip of raycaster as 1.1m forward of controller.  
      //       // var p = new THREE.Vector3(ray.x, ray.y, ray.z);
      //       // p.normalize();
      //       // p.multiplyScalar(1.2);
      //       // //Convert local position into world coordinate.
      //       // this.el.object3D.localToWorld(p);
      //       // //Move selected object to follow the tip of raycaster.
      //       // this.el.selectedObj.object3D.position.set(p.x, p.y, p.z);
      //   }
      // });

// setInterval(()=>{
//         const sphere = document.querySelector('#sphere');
//       sphere.object3D.position.set(sphere.object3D.position.x + 0.5,sphere.object3D.position.y,sphere.object3D.position.z )
//       },1000)

  const proto = [
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'7/70',
      tags:['peexe', 'macro', 'cve']
    },
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'7/70',
      tags:['peexe', 'macro', 'cve']
    },
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'0/70',
      tags:['peexe', 'macro', 'cve']
    },
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'7/70',
      tags:['peexe', 'macro', 'cve']
    },
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'0/70',
      tags:['peexe', 'macro', 'cve']
    },
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'0/70',
      tags:['peexe', 'macro', 'cve']
    },
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'7/70',
      tags:['peexe', 'macro', 'cve']
    },
    {
      hash:'d30d7676a3b4c91b77d403f81748ebf6b8824749db5f860e114a8a204bca5b8f',
      verdict:'7/70',
      tags:['peexe', 'macro', 'cve']
    },
  ]

      function moveUp(){
        window.requestAnimationFrame(()=>{
          let rows = document.querySelectorAll('.row');
          rows.forEach(row=>{
            row.object3D.position.y = row.object3D.position.y+0.01;
          })
          moveUp();
        })
      }
      setTimeout(()=>{

        function addRow(initialY = 0, hash, verdict, tags){
          // Creating subentities
          const row = document.createElement('a-entity');
          const box = document.createElement('a-box');
          const background = document.createElement('a-plane');
          const hashPlane = document.createElement('a-plane');
          const verdictPlane = document.createElement('a-plane');
          const tagsPlane = document.createElement('a-plane');

          // Different color depending on verdict
          const color = verdict[0] !== '0'?'#994259':'#567a5d';

          // Setting box
          box.setAttribute('color',color);
          box.setAttribute('position',`0 0 -0.25`);
          box.setAttribute('height','1');
          box.setAttribute('width','11');
          box.setAttribute('depth','0.5')

          // Setting background
          background.setAttribute('color','#cfcfcf');
          background.setAttribute('position',`0 0 0`);
          background.setAttribute('height','1');
          background.setAttribute('width','11');

          // Setting hashPlane
          hashPlane.setAttribute('color','#cfcfcf');
          hashPlane.setAttribute('position',`-2.5 0.25 0`);
          hashPlane.setAttribute('height','0.5');
          hashPlane.setAttribute('width','5');
          hashPlane.setAttribute('text',`value: ${hash}; color:black; wrap-count:63;`);
          
          // Setting verdictPlane
          verdictPlane.setAttribute('color','#cfcfcf');
          verdictPlane.setAttribute('position',`2.5 0.25 0`);
          verdictPlane.setAttribute('height','0.5');
          verdictPlane.setAttribute('width','5');
          verdictPlane.setAttribute('text',`value: ${verdict}; color:${color}; wrap-count:63; align:right;`);

          // Setting tagsPlane
          tagsPlane.setAttribute('color','#cfcfcf');
          tagsPlane.setAttribute('position',`-2.5 -0.25 0`);
          tagsPlane.setAttribute('height','0.5');
          tagsPlane.setAttribute('width','5');
          tagsPlane.setAttribute('text',`value: ${tags.join(', ')}; color:${color}; wrap-count:63; align:left;`);

          // Setting row
          row.classList.add('row');
          row.setAttribute('position',`0 ${initialY} 0`);
          row.appendChild(box);
          row.appendChild(background);
          row.appendChild(hashPlane);
          row.appendChild(verdictPlane);
          row.appendChild(tagsPlane);
          
          // Adding row
          const cubes = document.querySelector('#cubes');
          cubes.appendChild(row)

        }
        proto.forEach((item,index)=>{
          addRow(-index*1.3, item.hash, item.verdict, item.tags);
        })
      
        window.requestAnimationFrame(moveUp);
      },1000)

    </script>
  </head>
  <body>
    <div id="info"></div>
    <a-scene >
      <a-entity>
        <!-- <a-entity oculus-touch-controls="hand: right" input-listen></a-text> -->
        <a-entity id="cubes" position="-5 -3 -5" input-listen oculus-touch-controls="hand: right">
        </a-entity>
        <a-entity id="console" position="6 0 -5">
          <a-plane id="consolePlane" width="10" height="4" color="black"></a-plane>
        </a-entity>
        
        <a-sky color="lightblue"></a-sky>
      </a-entity>
    </a-scene>
    
  </body>

  
</html>